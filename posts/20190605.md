# elmã‚’vimã§æ›¸ã with language server
[elm\-tooling/elm\-language\-server: Language server implementation for Elm](https://github.com/elm-tooling/elm-language-server) ã®å®Ÿè£…ãŒé€²ã‚“ã§ãã¦ã€å®šç¾©ã¸ã®ã‚¸ãƒ£ãƒ³ãƒ—ã‚„hoverãªã©ãŒå¯èƒ½ã«ãªã£ãŸã€‚

æ™®æ®µã¯vimä½¿ã£ã¦ã‚‹ã‘ã©elmæ›¸ãã¨ãã ã‘ã¯atomãªã‚“ã ã‚ˆãªã€‚ã€‚ã¨ã„ã†äººã®å‚è€ƒã«ãªã‚Œã°ã„ã„ãªã¨æ€ã†ã€‚

ä»Šå›ã¯ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ–¹æ³•ä¸­å¿ƒã«æ›¸ã„ã¦ã„ãã€‚

## ç’°å¢ƒ
```
$ node -v
v11.12.0

$ npm --version
6.7.0

$ elm --version
0.19.0
$ elm-format --help
elm-format 0.8.1
$ elm-test --version
0.19.0-rev6

$ vim -v
NVIM v0.4.0-dev
```

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
### syntax
neovim/vim ã¨ã‚‚ã«åŸ·ç­†ç¾åœ¨ã¯elmã®ãŸã‚ã®syntaxã¯defaultã§ã¯å…¥ã£ã¦ã„ãªã„
* [neovim/runtime/syntax at master Â· neovim/neovim](https://github.com/neovim/neovim/tree/master/runtime/syntax)
* [vim/runtime/syntax at master Â· vim/vim](https://github.com/vim/vim/tree/master/runtime/syntax)

syntaxã®pluginã‚’å…¥ã‚Œã¦ã€æ°—æŒã¡ã‚ˆãé–‹ç™ºã—ãŸã„ã€‚

[ElmCast/elm\-vim: Elm plugin for Vim](https://github.com/ElmCast/elm-vim)

ã“ã®pluginã‚’åˆ©ç”¨ã—ã¦elmã®syntaxã‚’æœ‰åŠ¹ã«ã™ã‚‹

vim-plugã‚’ç”¨ã„ãŸplugin installã®ä¾‹ã¯ä»¥ä¸‹

```
Plug 'ElmCast/elm-vim', { 'for': 'elm' }
```

[![ss](https://raw.githubusercontent.com/cappyzawa/demo/master/elm-vim/elm-vim.png)](.)

ã ã„ã¶è¦‹ã‚„ã™ããªã£ãŸã€‚sytaxã‚’æœ‰åŠ¹ã«ã—ãŸã„ã ã‘ã ã‹ã‚‰defaultã®keybindingã¯ç„¡åŠ¹ã«ã—ã¦ãŠãã€‚
```
let g:elm_setup_keybindings = 0
```

### Lsp Server
[elm\-tooling/elm\-language\-server: Language server implementation for Elm](https://github.com/elm-tooling/elm-language-server)

```
$ git clone https://github.com/elm-tooling/elm-language-server.git
$ cd elm-language-server
$ git rev-parse HEAD
78aca21bd308bfc33540ef0c90b275ea4aaa4eb1
$ npm install
$ npm run compile
$ npm link

$ source ~/.zshrc
$ which elm-language-server
/Users/cappyzawa/.anyenv/envs/nodenv/shims/elm-language-server
```

`elm-language-server` ã‚³ãƒãƒ³ãƒ‰ã«PATHãŒé€šã£ã¦ã„ã‚Œã°OK


### Lsp Client
vimã§åˆ©ç”¨ã§ãã‚‹Lsp Clientã¯ä»¥ä¸‹ã®ã‚ˆã†ãªã‚‚ã®ãŒã‚ã‚‹
* [neoclide/coc\.nvim: Intellisense engine for vim8 & neovim, full language server protocol support as VSCode](https://github.com/neoclide/coc.nvim)
* [prabirshrestha/vim\-lsp: async language server protocol plugin for vim and neovim](https://github.com/prabirshrestha/vim-lsp)
* [autozimu/LanguageClient\-neovim: Language Server Protocol \(LSP\) support for vim and neovim\.](https://github.com/autozimu/LanguageClient-neovim)

çµå±€ã¯elmã®fileã‚’ç·¨é›†ã™ã‚‹ã¨ãã« `elm-language-server --stdio` ã‚³ãƒãƒ³ãƒ‰ãŒå®Ÿè¡Œã•ã‚Œã¦ã„ã‚Œã°ã„ã„ã‹ã‚‰ãŠå¥½ããªã‚‚ã®ã‚’é¸ã¹ã°ã„ã„ã€‚

coc.nvimã®è¨­å®šã¯[elm\-tooling/elm\-language\-server: Language server implementation for Elm](https://github.com/elm-tooling/elm-language-server#vim) ã«æ›¸ã„ã¦ã„ã‚‹é€šã‚Šãªã®ã§ã€ä»Šå›ã¯vim-lspã§è¨­å®šã—ã¦ã¿ã‚‹(æ™®æ®µã¯coc.nvimãªã‚“ã ãŒã€‚ã€‚)

ã¾ãŸREADMEã«ã¯[w0rp/ale](https://github.com/w0rp/ale)ã‚’ä½¿ã†ä¾‹ã‚‚ã‚ã‚‹ãŒã€lint/formatã¯ä¸Šè¨˜ã®lsp-clientã ã‘ã§ã‚‚è§£æ±ºã§ãã‚‹ã€‚(ã¤ã¾ã‚Š[antew/vim\-elm\-language\-server](https://github.com/antew/vim-elm-language-server) ã¯ã„ã‚Œãªãã¦ã‚‚å¤§ä¸ˆå¤«)

ä»¥ä¸‹ã‚’è¿½åŠ 
```
if executable('elm-language-server')
  au User lsp_setup call lsp#register_server({
    \ 'name': 'elm-language-server',
    \ 'cmd': {server_info->[&shell, &shellcmdflag, 'elm-language-server --stdio']},
    \ 'initialization_options': {
      \ 'runtime': 'node',
      \ 'elmPath': 'elm',
      \ 'elmFormatPath': 'elm-format',
      \ 'elmTestPath': 'elm-test',
      \ 'rootPatterns': 'elm.json'
      \ },
    \ 'whitelist': ['elm'],
    \ })
  autocmd BufWritePre *.elm LspDocumentFormat
endif
```

`autocmd BufWritePre`ã‚’è¨­å®šã—ã¦ã„ã‚‹ã“ã¨ã«ã‚ˆã‚Šã€ãƒ•ã‚¡ã‚¤ãƒ«æ›¸ãè¾¼ã¿å‰ã«`elm-format`ãŒã‹ã‹ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã‚‹ã€‚

ã‚ã¨ã¯elmã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ã„ã¦lsp-clientã®ã‚³ãƒãƒ³ãƒ‰ã‚’å©ã„ã¦ä½¿ç”¨æ„Ÿã‚’ç¢ºã‹ã‚ã‚Œã°è‰¯ã„ã€‚

åˆ©ç”¨å¯èƒ½ãªã‚³ãƒãƒ³ãƒ‰: [prabirshrestha/vim\-lsp#SupportedCommands](https://github.com/prabirshrestha/vim-lsp#supported-commands)

## ä»˜éŒ²
language-serverã®support actionã®ä¸€è¦§ => [Langserver\.org](https://langserver.org/)

vim x LSPã‚’ã‚‚ã£ã¨çŸ¥ã‚ŠãŸã„ => [LSPã‹ã‚™ã‚‚ãŸã‚‰ã—ãŸVimãƒ•ã‚šãƒ©ã‚¯ã‚™ã‚¤ãƒ³ã®å¤‰åŒ–ã«æ€ã„ã‚’é¦³ã›ã‚‹ \- Speaker Deck](https://speakerdeck.com/lighttiger2505/lspkamotarasitavimhurakuinfalsebian-hua-nisi-iwochi-seru)

elm-language-serverã®å‹•å‘ã‚’çŸ¥ã‚ŠãŸã„ => [#elm-language-server - Slack](https://elmlang.slack.com/messages/C6ZRS3ALU)

Elm-jp => [Elm\-jp](https://elm-lang.jp/)

## è¿½è¨˜
æ™®æ®µã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ã—ã¦pluginã®ä½ã¿åˆ†ã‘ã‚’ã—ã¦ã„ã‚‹
* lint/format:[ale/ale\.vim at master Â· w0rp/ale](https://github.com/w0rp/ale/blob/master/plugin/ale.vim)
* å®šç¾©jumpãªã©: [neoclide/coc\.nvim: Intellisense engine for vim8 & neovim, full language server protocol support as VSCode](https://github.com/neoclide/coc.nvim)

ã‚½ãƒ¼ã‚¹ã¯ [dotfiles/\.vim at master Â· cappyzawa/dotfiles](https://github.com/cappyzawa/dotfiles/tree/master/.vim) ã ãŒã€ãã‚Œãã‚Œã«é–¢ã™ã‚‹ã¨ã“ã‚ã‚’æŠœç²‹ã—ã¦ã‚³ãƒ”ãƒšã™ã‚Œã°(ãŸã¶ã‚“)ãã‚Œãªã‚Šã«ä½¿ãˆã‚‹ã‚³ãƒ¼ãƒ‰ã‚’è²¼ã£ã¦ãŠã

pluginã®install
```
Plug 'neoclide/coc.nvim', {'do': { -> coc#util#install()}}
Plug 'w0rp/ale'
Plug 'ElmCast/elm-vim', { 'for': 'elm' }
```

å„ç¨®è¨­å®š
```
" elm-vim
let g:elm_format_autosave = 0
let g:elm_setup_keybinding = 0
let g:elm_jump_to_error = 0

" ale
let g:ale_fix_on_save = 1
let g:ale_set_quickfix = 1
let g:ale_sign_error = 'ğŸ”¥'
let g:ale_sign_warning = 'âš¡ï¸'
let g:ale_echo_msg_error_str = 'ğŸ”¥'
let g:ale_echo_msg_warning_str = 'âš¡ï¸'
let g:ale_echo_msg_format = '[%linter%] %s [%severity%]'
let g:ale_fixers = {
\   'elm': ['elm-format'],
\}
let g:ale_elm_format_executable = 'elm-format'
let g:ale_elm_format_options = '--yes --elm-version=0.19'

" coc.nvim
nmap <silent> gd <Plug>(coc-definition)
nmap <silent> gy <Plug>(coc-type-definition)
nmap <silent> gi <Plug>(coc-implementation)
nmap <silent> gr <Plug>(coc-references)
nmap <silent> gt <Plug>(coc-rename)
nnoremap <silent> gk :call <SID>show_documentation()<CR>

function! s:show_documentation()
  if &filetype ==# 'vim'
    execute 'h '.expand('<cword>')
  else
    if coc#util#has_float()
      pc
    else
      call CocActionAsync('doHover')
    endif
  endif
endfunction
```

`:CocConfig`
```
{
  "suggest.triggerAfterInsertEnter": true,
  "suggest.noselect": false,
  "suggest.minTriggerInputLength": 2,
  "suggest.acceptSuggestionOnCommitCharacter": true,
  "suggest.snippetIndicator": " â–º",
  "suggest.enablePreview": true,
  "coc.preferences.hoverTarget": "float",
  "coc.preferences.diagnostic.displayByAle": true,
  "list.autoResize": true,
  "languageserver": {
    "elmLS": {
      "command": "elm-language-server",
      "args": [
        "--stdio"
      ],
      "filetypes": [
        "elm"
      ],
      "rootPatterns": [
        "elm.json"
      ],
      "initializationOptions": {
        "runtime": "node",
        "elmPath": "elm",
        "elmFormatPath": "elm-format"
      }
    }
  }
}
```

#### 2019/06/22 
[antew/vim\-elm\-language\-server merged into w0rp/ale Â· Issue \#1 Â· cappyzawa/medium](https://github.com/cappyzawa/medium/issues/1)

ã„ã‚ã„ã‚æƒ…å ±ã‚’ã‚‚ã‚‰ã£ãŸã®ã§ã“ã“ã«åŠ ç­†ã—ã¦ã„ã“ã†ã¨æ€ã†ã€‚

`elm-language-server`ã®installãŒç°¡å˜ã«ã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸã€‚

```
$ npm i -g @elm-tooling/elm-language-server 
```

elm-toolingã§vimã§elmã‹ãã«ã¯ã“ã‚Œå…¥ã‚ŒãŸæ–¹ãŒã„ã„ã£ã‚ˆã£ã¦ã‚„ã¤ãŒã§ãŸ

[elm\-tooling/elm\-vim: Vim tooling for working with Elm](https://github.com/elm-tooling/elm-vim)

